import{_ as f,r as p,c as g,o as s,w as h,b as a,d as _,e as o,t as i,F as l,a as r}from"./index-NXnxvJjD.js";const u=["B","kiB","MiB","GiB"],m=t=>{let e=0;for(;t>1e3&&e<u.length;)t/=1e3,e++;return Intl.NumberFormat(void 0,{maximumFractionDigits:2}).format(t||0)+` ${u[e]}/s`},y={name:"RTorrent",props:{item:Object},data:()=>({dl:null,ul:null,count:null,error:null}),computed:{downRate:function(){return m(this.dl)},upRate:function(){return m(this.ul)}},created(){const t=parseInt(this.item.rateInterval,10)||0,e=parseInt(this.item.torrentInterval,10)||0;t>0&&setInterval(()=>this.fetchRates(),t),e>0&&setInterval(()=>this.fetchCount(),e),this.fetchRates(),this.fetchCount()},methods:{fetchRates:async function(){this.getRate("throttle.global_up.rate").then(t=>this.ul=t).catch(()=>this.error=!0),this.getRate("throttle.global_down.rate").then(t=>this.dl=t).catch(()=>this.error=!0)},fetchCount:async function(){this.getCount().catch(()=>this.error=!0)},getRate:async function(t){return this.getXml(t).then(e=>parseInt(e.getElementsByTagName("value")[0].firstChild.textContent,10))},getCount:async function(){return this.getXml("download_list").then(t=>{const e=t.getElementsByTagName("array");this.count=e?e[0].getElementsByTagName("value").length:0})},getXml:async function(t){const e={"Content-Type":"text/xml"};return this.item.username&&this.item.password&&(e.Authorization=`${this.item.username}:${this.item.password}`),fetch(`${this.item.xmlrpc.replace(/\/$/,"")}/RPC2`,{method:"POST",headers:e,body:`<methodCall><methodName>${t}</methodName></methodCall>`}).then(n=>{if(!n.ok)throw Error(n.statusText);return n.text()}).then(n=>Promise.resolve(new DOMParser().parseFromString(n,"text/xml")))}}},C={class:"title is-4"},R={class:"subtitle is-6"},w={key:0,class:"error"},v={class:"down"},B={class:"up"},I={key:0,class:"count"};function k(t,e,n,x,b,c){const d=p("Generic");return s(),g(d,{item:n.item},{content:h(()=>[r("p",C,i(n.item.name),1),r("p",R,[t.error?(s(),a("span",w,"An error has occurred.")):(s(),a(l,{key:1},[r("span",v,[e[0]||(e[0]=r("i",{class:"fas fa-download"},null,-1)),o(" "+i(c.downRate),1)]),r("span",B,[e[1]||(e[1]=r("i",{class:"fas fa-upload"},null,-1)),o(" "+i(c.upRate),1)])],64))])]),indicator:h(()=>[t.error?_("",!0):(s(),a("span",I,[o(i(t.count)+" ",1),t.count===1?(s(),a(l,{key:0},[o("torrent")],64)):(s(),a(l,{key:1},[o("torrents")],64))]))]),_:1},8,["item"])}const T=f(y,[["render",k],["__scopeId","data-v-bcebd113"]]);export{T as default};
