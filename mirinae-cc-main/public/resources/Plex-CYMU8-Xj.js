import{_ as u,s as k,r as y,c as v,o as r,w as _,a as x,b as i,d as a,t as c}from"./index-NXnxvJjD.js";const P={name:"Plex",mixins:[k],props:{item:Object},data:()=>({streams:null,series:null,movies:null,warnings:null,errors:null,serverError:!1}),created:function(){const e=parseInt(this.item.checkInterval,10)||0;e>0&&setInterval(()=>this.fetchData(),e),this.fetchData()},methods:{fetchData:function(){const e=o=>{console.error(o),this.serverError=!0};this.fetch(`/status/sessions?X-Plex-Token=${this.item.token}`,{},!1).then(o=>{const l=new DOMParser().parseFromString(o,"application/xml").getElementsByTagName("MediaContainer")[0];this.streams=l&&l.getAttribute("size")||0}).catch(e),this.fetch(`/library/sections?X-Plex-Token=${this.item.token}`,{},!1).then(o=>{const n=new DOMParser,l=n.parseFromString(o,"application/xml").getElementsByTagName("Directory"),h=[],m=[];for(let t of l)t.getAttribute("type")==="show"?h.push(t.getAttribute("key")):t.getAttribute("type")==="movie"&&m.push(t.getAttribute("key"));let f=0;Promise.all(h.map(t=>fetch(`${this.endpoint}/library/sections/${t}/all?X-Plex-Token=${this.item.token}`).then(s=>s.text()).then(s=>{const p=n.parseFromString(s,"application/xml");f+=p.getElementsByTagName("Directory").length}).catch(e))).then(()=>{this.series=f}).catch(e);let g=0;Promise.all(m.map(t=>fetch(`${this.endpoint}/library/sections/${t}/all?X-Plex-Token=${this.item.token}`).then(s=>s.text()).then(s=>{const p=n.parseFromString(s,"application/xml");g+=p.getElementsByTagName("Video").length}).catch(e))).then(()=>{this.movies=g})}).catch(e)}}},$={class:"notifs"},b={key:0,class:"notif activity",title:"Active Streams"},D={key:1,class:"notif series",title:"Total Series"},E={key:2,class:"notif movies",title:"Total Movies"},T={key:3,class:"notif warnings",title:"Warning"},w={key:4,class:"notif errors",title:"Error"},B={key:5,class:"notif errors",title:"Connection error to Plex API, check url and token in config.yml"};function I(e,o,n,d,l,h){const m=y("Generic");return r(),v(m,{item:n.item},{indicator:_(()=>[x("div",$,[e.streams>0?(r(),i("strong",b,c(e.streams),1)):a("",!0),e.series>0?(r(),i("strong",D,c(e.series),1)):a("",!0),e.movies>0?(r(),i("strong",E,c(e.movies),1)):a("",!0),e.warnings>0?(r(),i("strong",T,c(e.warnings),1)):a("",!0),e.errors>0?(r(),i("strong",w,c(e.errors),1)):a("",!0),e.serverError?(r(),i("strong",B," ? ")):a("",!0)])]),_:1},8,["item"])}const C=u(P,[["render",I],["__scopeId","data-v-fd5969f7"]]);export{C as default};
